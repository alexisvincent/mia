events {
    worker_connections 1024;
}

http {
    # Define the expected bearer token
    # IMPORTANT: Change this to your actual secret token!
    map $http_authorization $token_valid {
        default 0;
        "Bearer 4HHhwB34UCYV6TJpUJYe" 1;
    }

    server {
        listen 80;
        server_name _;

        location / {
            # Check if token is valid
            if ($token_valid = 0) {
                return 401 "Unauthorized: Invalid or missing bearer token\n";
            }

            # Proxy configuration
            proxy_pass http://backend;

            # Forward original headers
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Remove the Authorization header before forwarding
            # The proxy handles auth, backend doesn't need to see it
            proxy_set_header Authorization "";
        }
    }

    # Define your backend upstream
    # Change this to your actual backend server
    upstream backend {
        server apollo-9.tail7b61.ts.net:23373;
    }
}
